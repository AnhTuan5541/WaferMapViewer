@{
    Layout = "~/Views/Shared/_LayoutAuth.cshtml";
}

@section Styles {

}

<div id="content">
    <div class="login-logo">
    <b>Tooling Management</b>
    </div>
    <!-- /.login-logo -->
    <div class="card">
    <div class="card-body login-card-body">
        <p class="login-box-msg">Sign in to start your session</p>

        <div>
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Username" id="username"onkeydown="handleEnter(event)">
            <div class="input-group-append">
            <div class="input-group-text">
                <span class="fas fa-envelope"></span>
            </div>
            </div>
        </div>
        <div class="input-group mb-3">
            <input type="password" class="form-control" placeholder="Password" id="password" onkeydown="handleEnter(event)">
            <div class="input-group-append">
            <div class="input-group-text">
                <span class="fas fa-lock"></span>
            </div>
            </div>
        </div>

        <div class="form-group">
            <label>Select Site</label>
            <select class="form-control" id="site">
                <option>ATV</option>
                <option>ATI</option>
                <option>ATK</option>
                <option>ATJ</option>
                <option>ATC</option>
                <option>ATM</option>
                <option>ATP</option>
                <option>ATT</option>
                <option>ATT</option>
                <option>ATEP</option>
            </select>
        </div>

        <div class="row">
            <div class="col-7">
            @* <div class="icheck-primary">
                <input type="checkbox" id="remember">
                <label for="remember">
                Remember Me
                </label>
            </div> *@
            </div>
            <!-- /.col -->
            <div class="col-5">
            <button class="btn btn-primary btn-block" onclick="login()">Sign In</button>
            </div>
            <!-- /.col -->
        </div>
        </div>

    </div>
    <!-- /.login-card-body -->
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {

        })

        function handleEnter(event) {
            if (event.key === 'Enter') {
                login();
            }
        }

        function login() {
            let username = document.getElementById('username').value;
            let password = document.getElementById('password').value;
            let site = document.getElementById('site').value;

            if (!username) {
                alert("Username cannot be blank!")
                return;
            }
            if (!password) {
                alert("Password cannot be blank!")
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').classList.add('opacity-content')
            let data = {
                "userid": username,
                "password": password,
                "site": site
            }

            $.ajax({
                url: '/Auth/GetUserInfo', 
                type: 'POST',
                data: data,
                success: function (res) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').classList.remove('opacity-content')
                    if (res.statusCode == 'FAIL') {
                        alert(res.message)
                        return;
                    }
                    localStorage.setItem('display_name', res.data[0].display_name);
                    localStorage.setItem('title_name', res.data[0].title_name);
                    localStorage.setItem('email', res.data[0].email);
                    localStorage.setItem('user_id', res.data[0].user_id);
                    localStorage.setItem('role', JSON.stringify(res.data[0].role));

                    document.cookie = "esign_token=" + res.data[0].token + "; path=/; expires=" + new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000).toUTCString();

                    window.location.replace("/")
                },
                error: function (err) {
                    alert('An error occurred. ' + err.responseText);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').classList.remove('opacity-content')
                }
            });

        }
    </script>
}



